<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>Master Item | Juragan Buah</title>

  <link rel="stylesheet" href="../css/styles.css">
  <script src="../js/data.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/barcode.js"></script>
</head>

<body>

<!-- ================= TOPBAR ================= -->
<div class="topbar">
  <div class="logo">
    <img src="../assets/logo.png">
    <strong>Juragan Buah</strong>
  </div>
  <nav>
    <a href="dashboard.html">Dashboard</a>
    <a href="items.html" class="active">Master Item</a>
    <a href="sales.html">Penjualan</a>
    <a href="report-stock.html">Laporan Stok</a>
    <a href="#" onclick="logout()">Logout</a>
  </nav>
</div>

<!-- ================= CONTENT ================= -->
<div class="container">

  <!-- ADD ITEM -->
  <div class="card">
    <h3>Tambah Item</h3>

    <input id="name" placeholder="Nama Item">
    <input id="barcode" placeholder="Barcode">
    <input id="unit" placeholder="Satuan (kg / pcs)">
    <input id="price" type="number" placeholder="Harga Jual">
    <input id="cost" type="number" placeholder="Harga Modal">
    <input id="stock" type="number" placeholder="Stok Awal">

    <input type="file" id="image" accept="image/*">

    <button type="button" class="btn btn-green" id="saveBtn">
      Simpan Item
    </button>
  </div>

  <!-- ITEM LIST -->
  <div class="card">
    <h3>Daftar Item</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Gambar</th>
          <th>Nama</th>
          <th>Barcode</th>
          <th>Stok</th>
          <th>Harga</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="itemBody"></tbody>
    </table>
  </div>

</div>

<!-- ================= SCRIPT ================= -->
<script>
const body = document.getElementById("itemBody");

function loadItems() {
  body.innerHTML = "";
  const items = DataStore.getItems();

  if (items.length === 0) {
    body.innerHTML = `<tr><td colspan="6" align="center">Belum ada item</td></tr>`;
    return;
  }

  items.forEach((i, idx) => {
    body.innerHTML += `
      <tr>
        <td>${i.image ? `<img src="${i.image}" class="thumb">` : "-"}</td>
        <td>${i.name}</td>
        <td>${i.barcode || "-"}</td>
        <td>${i.stock}</td>
        <td>Rp ${i.price}</td>
        <td>
          <button type="button" class="btn btn-red btn-sm" onclick="removeItem(${idx})">Hapus</button>
        </td>
      </tr>
    `;
  });
}

function removeItem(index) {
  const items = DataStore.getItems();
  items.splice(index, 1);
  DataStore.saveItems(items);
  loadItems();
}

document.getElementById("saveBtn").onclick = () => {
  const reader = new FileReader();
  const file = document.getElementById("image").files[0];

  reader.onload = () => {
    const items = DataStore.getItems();
    items.push({
      id: "I" + Date.now(),
      name: name.value,
      barcode: barcode.value,
      unit: unit.value,
      price: +price.value,
      cost: +cost.value,
      stock: +stock.value,
      image: reader.result || ""
    });
    DataStore.saveItems(items);
    loadItems();
  };

  if (file) reader.readAsDataURL(file);
  else reader.onload();
};

loadItems();
</script>

</body>
</html>
