<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Data Pembeli | Juragan Buah</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../css/styles.css">
<script src="../js/utils.js"></script>
<script src="../js/data.js"></script>
</head>

<body>

<header class="topbar">
  <div class="brand">
    <img src="../assets/logo.png" class="logo">
    <span>Juragan Buah</span>
  </div>
  <a href="dashboard.html" class="btn btn-light">â¬… Dashboard</a>
</header>

<main class="container">
  <div class="card">
    <div class="card-header">
      <h2>ğŸ‘¥ Data Pembeli</h2>
      <button class="btn btn-green" onclick="openModal()">+ Tambah Pembeli</button>
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Nama</th>
            <th>Telepon</th>
            <th>Alamat</th>
            <th width="120">Aksi</th>
          </tr>
        </thead>
        <tbody id="buyerTable"></tbody>
      </table>
    </div>
  </div>
</main>

<!-- MODAL -->
<div class="modal" id="buyerModal">
  <div class="modal-content">
    <h3 id="modalTitle">Tambah Pembeli</h3>

    <input type="hidden" id="buyerId">

    <label>Nama</label>
    <input id="buyerName" placeholder="Nama pembeli">

    <label>No. Telepon</label>
    <input id="buyerPhone" placeholder="08xxxx">

    <label>Alamat</label>
    <textarea id="buyerAddress" placeholder="Alamat"></textarea>

    <div class="modal-actions">
      <button class="btn btn-green" onclick="saveBuyer()">ğŸ’¾ Simpan</button>
      <button class="btn btn-red" onclick="closeModal()">Batal</button>
    </div>
  </div>
</div>

<script>
/* =========================
   LOAD DATA
========================= */
function loadBuyers() {
  const tbody = document.getElementById("buyerTable");
  tbody.innerHTML = "";

  DataStore.getBuyers().forEach(b => {
    tbody.innerHTML += `
      <tr>
        <td>${b.name}</td>
        <td>${b.phone || "-"}</td>
        <td>${b.address || "-"}</td>
        <td>
          <button class="btn btn-small" onclick="editBuyer('${b.id}')">âœï¸</button>
          <button class="btn btn-small btn-red" onclick="deleteBuyer('${b.id}')">ğŸ—‘</button>
        </td>
      </tr>
    `;
  });
}

/* =========================
   MODAL
========================= */
function openModal() {
  document.getElementById("buyerModal").style.display = "flex";
}

function closeModal() {
  document.getElementById("buyerModal").style.display = "none";
  buyerId.value = "";
  buyerName.value = "";
  buyerPhone.value = "";
  buyerAddress.value = "";
}

/* =========================
   CRUD
========================= */
function saveBuyer() {
  const id = buyerId.value;
  const name = buyerName.value.trim();
  const phone = buyerPhone.value.trim();
  const address = buyerAddress.value.trim();

  if (!name) {
    alert("Nama pembeli wajib diisi");
    return;
  }

  if (id) {
    DataStore.updateBuyer(id, { name, phone, address });
  } else {
    DataStore.addBuyer({ name, phone, address });
  }

  closeModal();
  loadBuyers();
}

function editBuyer(id) {
  const buyer = DataStore.getBuyers().find(b => b.id === id);
  if (!buyer) return;

  buyerId.value = buyer.id;
  buyerName.value = buyer.name;
  buyerPhone.value = buyer.phone || "";
  buyerAddress.value = buyer.address || "";

  openModal();
}

function deleteBuyer(id) {
  if (confirm("Hapus pembeli ini?")) {
    DataStore.deleteBuyer(id);
    loadBuyers();
  }
}

document.addEventListener("DOMContentLoaded", loadBuyers);
</script>

</body>
</html>
