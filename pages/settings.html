<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Backup & Restore</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../css/styles.css">
</head>
<body>

<div class="app">

<aside class="sidebar">
  <div class="sidebar-header">
    <img src="../assets/logo.png">
    <span>Juragan Buah</span>
  </div>
  <nav class="menu">
    <a href="dashboard.html">Dashboard</a>
    <a class="active" href="settings.html">Backup Data</a>
  </nav>
</aside>

<main class="content">

<header class="content-header">
  <button id="sidebarToggle">â˜°</button>
  <h2>Backup & Restore Data</h2>
</header>

<div class="card">
  <h3>Backup Data</h3>
  <p>Simpan semua data (item, penjualan, user)</p>
  <button class="btn btn-green" onclick="backupData()">Download Backup</button>
</div>

<div class="card">
  <h3>Restore Data</h3>
  <p>Upload file backup (.json)</p>
  <input type="file" id="restoreFile" accept="application/json">
  <button class="btn btn-red" onclick="restoreData()">Restore</button>
</div>
<div class="card">
  <h3>Import Master Item (CSV)</h3>
  <input type="file" id="csvItem" accept=".csv">
  <button class="btn btn-green" onclick="importItemsCSV()">Import CSV</button>
</div>

<div class="card">
  <h3>Export Penjualan (CSV)</h3>
  <button class="btn btn-blue" onclick="exportSalesCSV()">Export CSV</button>
</div>

</main>
</div>

<script>
/* ===============================
   SIDEBAR
================================ */
document.getElementById("sidebarToggle").onclick = () =>
  document.querySelector(".sidebar").classList.toggle("open");

/* ===============================
   BACKUP
================================ */
function backupData() {
  const data = {
    items: JSON.parse(localStorage.getItem("items")) || [],
    sales: JSON.parse(localStorage.getItem("sales")) || [],
    users: JSON.parse(localStorage.getItem("users")) || []
  };

  const blob = new Blob(
    [JSON.stringify(data, null, 2)],
    { type: "application/json" }
  );

  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "backup-juragan-buah.json";
  a.click();
  URL.revokeObjectURL(url);
}

/* ===============================
   RESTORE
================================ */
function restoreData() {
  const file = document.getElementById("restoreFile").files[0];
  if (!file) return alert("Pilih file backup");

  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);

      if (!data.items || !data.sales) {
        return alert("File backup tidak valid");
      }

      localStorage.setItem("items", JSON.stringify(data.items));
      localStorage.setItem("sales", JSON.stringify(data.sales));

      if (data.users) {
        localStorage.setItem("users", JSON.stringify(data.users));
      }

      alert("Restore berhasil");
      location.href = "dashboard.html";

    } catch {
      alert("Gagal membaca file");
    }
  };
  reader.readAsText(file);
}

  function importItemsCSV() {
  const file = document.getElementById("csvItem").files[0];
  if (!file) return alert("Pilih file CSV");

  const reader = new FileReader();
  reader.onload = e => {
    const lines = e.target.result.split("\n");
    const headers = lines[0].split(",");

    const items = JSON.parse(localStorage.getItem("items")) || [];

    for (let i = 1; i < lines.length; i++) {
      if (!lines[i].trim()) continue;

      const data = lines[i].split(",");

      const item = {
        id: Date.now() + i,
        name: data[headers.indexOf("name")] || "",
        price: Number(data[headers.indexOf("price")] || 0),
        stock: Number(data[headers.indexOf("stock")] || 0),
        barcode: data[headers.indexOf("barcode")] || "",
        unit: data[headers.indexOf("unit")] || "pcs",
        image: data[headers.indexOf("image")] || ""
      };

      items.push(item);
    }

    localStorage.setItem("items", JSON.stringify(items));
    alert("Import item berhasil");
  };

  reader.readAsText(file);
}

</script>

</body>
</html>
