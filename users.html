<!doctype html>
<html lang="id">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>User Management â€” Juragan Buah</title><link rel="stylesheet" href="../css/styles.css">><script src="utils.js"></script><script src="data.js"></script></head>
<body>
  <div class="sidebar"><img src="assets/logo.svg" class="sidebar-logo"><div class="app-name">Juragan Buah</div><nav><a href="../pages/dashboard.html">Dashboard</a><a href="users.html" class="active">User Management</a></nav></div>
  <div class="main"><header class="topbar"><h2>Manajemen User</h2></header><div class="container">
  <div class="card"><button class="btn" id="addUserBtn">+ Tambah User</button><table id="usr_tbl" class="mt10"><thead><tr><th>Username</th><th>Role</th><th>Aksi</th></tr></thead><tbody></tbody></table></div>
  </div></div>

<div id="modal" class="modal-bg"><div id="modalBox" class="modal-box"></div></div>
<div id="toast" class="toast"></div>

<script>
(function(){ if(!DataStore.getLoginUser()) location.href='login.html';
  function render(){ const tb=document.querySelector('#usr_tbl tbody'); tb.innerHTML=''; DataStore.getUsers().forEach(u=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${u.username}</td><td>${u.role}</td><td><button class="btn" onclick="editUser('${u.id}')">Edit</button> <button class="btn btn-danger" onclick="delUser('${u.id}')">Hapus</button></td>`; tb.appendChild(tr); }); }
  window.editUser = function(id){ const u = DataStore.getUsers().find(x=>x.id===id); openModal(`<h3>Edit User</h3><label>Username</label><input id="eu_user" value="${u.username}"><label>Password (kosong jika tak ganti)</label><input id="eu_pass" type="password"><label>Role</label><select id="eu_role"><option value="admin" ${u.role==='admin'?'selected':''}>admin</option><option value="kasir" ${u.role==='kasir'?'selected':''}>kasir</option></select><div style="text-align:right;margin-top:10px"><button class="btn" id="saveUsr">Simpan</button></div>`); setTimeout(()=>document.getElementById('saveUsr').onclick = ()=>{ DataStore.updateUser(u.id, { username: eu_user.value.trim(), password: eu_pass.value? eu_pass.value : null, role: eu_role.value }); closeModal(); render(); },40); };
  window.delUser = function(id){ if(!confirm('Hapus user?')) return; DataStore.deleteUser(id); toast('User dihapus'); render(); };
  document.getElementById('addUserBtn').onclick = ()=> { openModal(`<h3>Tambah User</h3><label>Username</label><input id="nu_user"><label>Password</label><input id="nu_pass" type="password"><label>Role</label><select id="nu_role"><option value="kasir">kasir</option><option value="admin">admin</option></select><div style="text-align:right;margin-top:10px"><button class="btn" id="saveNewUser">Simpan</button></div>`); setTimeout(()=>document.getElementById('saveNewUser').onclick = ()=>{ DataStore.addUser({ username: nu_user.value.trim(), password: nu_pass.value || '123456', role: nu_role.value, created: today() }); closeModal(); render(); },40); };
  window.openModal = function(html){ document.getElementById('modalBox').innerHTML = html; document.getElementById('modal').style.display='flex'; };
  window.closeModal = function(){ document.getElementById('modal').style.display='none'; };
  window.toast = function(m){ const t=document.getElementById('toast'); t.innerText=m; t.style.display='block'; setTimeout(()=> t.style.display='none',1800); };
  render();
})();
</script>
</body>
</html>
