<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Penjualan â€“ Juragan Buah</title>
<link rel="stylesheet" href="styles.css">

<style>
body {
    background: #f3f6f4;
    font-family: Poppins, sans-serif;
    margin: 0;
}

.header {
    background: #2e7d32;
    color: white;
    padding: 15px 20px;
    font-size: 20px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
}

.container {
    padding: 15px;
}

.box {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
}

label {
    font-weight: 600;
}

select, input {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

.btn {
    padding: 12px;
    border: none;
    border-radius: 8px;
    background: #2e7d32;
    color: white;
    font-weight: bold;
    width: 100%;
    margin-top: 10px;
    cursor: pointer;
}
.btn:hover { background: #46a149; }

.table {
    width: 100%;
    border-collapse: collapse;
}
.table th, .table td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
}
.table th {
    background: #e8f5e9;
}

.total-box {
    font-size: 20px;
    font-weight: 700;
    text-align: right;
    padding: 10px;
}

.invoice-box {
    display: none;
    background: white;
    padding: 20px;
    margin-top: 20px;
    border-radius: 10px;
}
.print-btn {
    background: #000;
    color: white;
    padding: 10px;
    border-radius: 8px;
    width: 100%;
    margin-top: 15px;
    cursor: pointer;
}
</style>

<script src="data.js"></script>
<script src="utils.js"></script>

</head>
<body>

<div class="header">
    <span>Kasir Penjualan</span>
    <button onclick="logout()" style="background:#c62828;color:white;border:none;padding:8px 15px;border-radius:8px">Logout</button>
</div>

<div class="container">

    <!-- PILIH PEMBELI -->
    <div class="box">
        <label>Pilih Konsumen</label>
        <select id="buyerSelect"></select>
    </div>

    <!-- PILIH ITEM -->
    <div class="box">
        <label>Pilih Barang</label>
        <select id="itemSelect"></select>

        <label>Qty</label>
        <input type="number" id="qtyInput" min="1" value="1">

        <button class="btn" onclick="addItem()">+ Tambah Item</button>
    </div>

    <!-- TABEL PEMBELIAN -->
    <div class="box">
        <table class="table" id="cartTable">
            <thead>
                <tr>
                    <th>Barang</th>
                    <th>Qty</th>
                    <th>Harga</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="total-box">
            Total: <span id="grandTotal">0</span>
        </div>
    </div>

    <!-- METODE PEMBAYARAN -->
    <div class="box">
        <label>Metode Pembayaran</label>
        <select id="payMethod">
            <option value="tunai">Tunai</option>
            <option value="qris">QRIS</option>
            <option value="transfer">Transfer</option>
        </select>

        <label>Bayar</label>
        <input type="number" id="payAmount" value="0" oninput="updateKembali()">

        <div style="margin-top:10px;font-weight:bold">
            Kembali: <span id="kembali">0</span>
        </div>

        <button class="btn" onclick="finishSale()">Selesaikan Transaksi</button>
    </div>

    <!-- INVOICE -->
    <div class="invoice-box" id="invoiceBox">
        <h3>Struk Pembayaran</h3>
        <div id="invoiceContent"></div>

        <button class="print-btn" onclick="window.print()">ðŸ–¨ Print Struk</button>
    </div>

</div>

<script>
// LOAD DATA PEMBELI & ITEM
function loadData() {
    const buyerSelect = document.getElementById("buyerSelect");
    buyers.forEach(b => {
        buyerSelect.innerHTML += `<option value="${b.id}">${b.name}</option>`;
    });

    const itemSelect = document.getElementById("itemSelect");
    items.forEach(i => {
        itemSelect.innerHTML += `<option value="${i.id}">${i.name} - Rp${i.price}</option>`;
    });
}

let cart = [];

function addItem() {
    const id = document.getElementById("itemSelect").value;
    const qty = parseInt(document.getElementById("qtyInput").value);

    const item = items.find(x => x.id == id);
    if (!item) return;

    const total = item.price * qty;

    cart.push({
        name: item.name,
        qty,
        price: item.price,
        total
    });

    renderCart();
}

function renderCart() {
    const tbody = document.querySelector("#cartTable tbody");
    tbody.innerHTML = "";

    let grand = 0;

    cart.forEach(c => {
        tbody.innerHTML += `
        <tr>
            <td>${c.name}</td>
            <td>${c.qty}</td>
            <td>Rp${c.price}</td>
            <td>Rp${c.total}</td>
        </tr>`;
        grand += c.total;
    });

    document.getElementById("grandTotal").innerText = grand;
}

function updateKembali() {
    const bayar = parseInt(document.getElementById("payAmount").value);
    const total = parseInt(document.getElementById("grandTotal").innerText);

    let kembali = bayar - total;
    if (kembali < 0) kembali = 0;

    document.getElementById("kembali").innerText = kembali;
}

function finishSale() {
    const buyerID = document.getElementById("buyerSelect").value;
    const buyer = buyers.find(x => x.id == buyerID);

    const metode = document.getElementById("payMethod").value;
    const total = document.getElementById("grandTotal").innerText;
    const bayar = document.getElementById("payAmount").value;
    const kembali = document.getElementById("kembali").innerText;

    // INVOICE
    document.getElementById("invoiceBox").style.display = "block";
    document.getElementById("invoiceContent").innerHTML = `
        <p><b>Pembeli:</b> ${buyer.name}</p>
        <p><b>Metode:</b> ${metode.toUpperCase()}</p>
        <p><b>Total:</b> Rp${total}</p>
        <p><b>Bayar:</b> Rp${bayar}</p>
        <p><b>Kembali:</b> Rp${kembali}</p>
        <hr>
        <b>Detail Barang:</b>
        <ul>
            ${cart.map(c => `<li>${c.name} (${c.qty}) - Rp${c.total}</li>`).join("")}
        </ul>
    `;

    cart = [];
    renderCart();
}

// LOGOUT
function logout() {
    localStorage.removeItem("loginUser");
    window.location = "login.html";
}

loadData();
</script>

</body>
</html>
